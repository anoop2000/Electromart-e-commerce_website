



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
    /* General Styles */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9f9f9;
    }

    .container {
        width: 90%;
        margin: auto;
        padding: 20px 0;
        display: flex;
        justify-content: space-between;
    }

    /* Product Section */
    .product-detail {
        display: flex;
        flex-wrap: wrap;
    }

    /* Left Section: Main Image and Thumbnails */
    .image-section {
        flex: 1;
        max-width: 45%;
    }

    .image-container {
        position: relative;
        overflow: hidden;
        width: 150%;
        height: 450px;
        border-radius: 10px;
        margin-bottom: 30px;
        margin-left :-250px;
    }

    .thumbnail-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        
    }



    .main-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .image-container:hover .main-image {
        transform: scale(2.5);
        cursor: zoom-in;
    }


    .thumbnail {
        width: 100px;
        height: 100px;
        cursor: pointer;
        border: 2px solid transparent;
        border-radius: 5px;
        object-fit: cover;
        transition: transform 0.3s, border 0.3s;
       
    }

    .thumbnail:hover {
        transform: scale(1.1);
        border: 2px solid #ff6b6b;
    }

    .thumbnail.active {
        border: 2px solid #ff6b6b;
    }

    /* Right Section: Product Details */
    .detail-section {
        flex: 1;
        max-width: 50%;
        padding-left: 20px;
    }

    .breadcrumb {
        margin-bottom: 20px;
        color: #666;
        margin-left: -100px;
    }

    .breadcrumb a {
        text-decoration: none;
        color: #007bff;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    
    .title-detail {
        font-size: 24px;
        color: #333;
        margin-bottom: 10px;
    }

    .product-price {
        font-size: 20px;
        color: #ff6b6b;
        margin: 10px 0;
    }

    .short-desc {
        margin: 20px 0;
    }

    .product-meta {
        list-style: none;
        padding: 0;
    }

    .product-meta li {
        margin-bottom: 10px;
    }

    .button {
        background: #ff6b6b;
        color: #fff;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .button:hover {
        background: #ff4c4c;
    }


    .breadcrumb-container {
    background-color: #f8f9fa; 
    padding: 10px 20px;
    border-bottom: 1px solid #eaeaea; 
    margin-top: 70px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.breadcrumb {
    font-size: 14px;
    color: #6c757d; 
    font-family: Arial, sans-serif;
}

.breadcrumb a {
    text-decoration: none;
    color: #007bff; 
    margin-right: 5px;
}

.breadcrumb a:hover {
    text-decoration: underline; 
}

.breadcrumb span {
    color: #333;
    font-weight: bold;
}

 /* Styling for the rating stars */
 .rating-stars {
        display: inline-flex;
        gap: 3px;
        font-size: 16px; 
        vertical-align: middle;
    }

    .text-warning {
        color: #ffc107; 
    }

    .text-muted {
        color: #e0e0e0; 
    }

    .product-detail-rating {
        display: flex;
        align-items: center;
        gap: 8px; 
        font-size: 14px;
    }

    .font-small {
        font-size: 13px;
        color: #6c757d; 
    }

    .product-detail-rating span {
        vertical-align: middle; 
    }


    .product-detail-rating {
        display: flex;
        align-items: center;
        gap: 10px; 
        font-size: 16px; 
        margin-top: 10px;
    }

    /* Styling for the star icons */
    .rating-stars {
        display: inline-flex;
        gap: 5px; 
    }

    .rating-stars i {
        font-size: 13px; 
    }

    .text-warning {
        color: #ffc107; 
    }

    .text-muted {
        color: #d6d6d6; 
    }

    /* Styling the reviews text */
    .font-small {
        font-size: 14px;
        color: #6c757d;
    }

    .thin-line {
        display: inline-block; 
        width: 100%;
        height: 1px; 
        background-color: #ccc; 
        margin: 5px 0; 
    }


    /* related product section */

    .related-products-sectionP{
        margin-left: 100px;
    }
   


    /* Responsive Styles */
    @media (max-width: 768px) {
        .product-detail {
            flex-direction: column;
        }

        .detail-section {
            padding-left: 0;
        }
    }
</style>

<%- include("../../views/partials/user/header") %>

<div class="container">
    <!-- Breadcrumb -->
    <div class="breadcrumb-wrapper">
        <div class="breadcrumb">
            <a href="/">Home</a> > 
            <a href="/categories/<%= category._id %>"><%= category.name %></a> > 
            <h5><%= product.productName %></h5>
        </div>
    </div>
    
    <div class="product-detail">
        <!-- Left Section: Images -->
        <div class="image-section">
            <div class="image-container">
                <img class="main-image" id="mainImage" src="/uploads/re-image/<%= product.productImage[0] %>" alt="Product">
            </div>
            <div class="thumbnail-container" >
                <% product.productImage.forEach((img, index) => { %>
                    <img class="thumbnail <%= index === 0 ? 'active' : '' %>" data-index="<%= index %>" src="/uploads/re-image/<%= img %>" alt="Thumbnail">
                <% }) %>
            </div>
        </div>


        

        <!-- Right Section: Details -->
        <div class="detail-section">
            <h1 class="title-detail" style="font-weight: 600; font-size: 24px; color: #333;"><%= product.productName %></h1>

            <!-- <div class="product-detail-rating">
                <span>Ratings: </span>
                <span class="rating-stars">
                    <% for (let i = 1; i <= 5; i++) { %>
                        <i class="fas fa-star <% if (i <= product.rating) { %>text-warning<% } else { %>text-muted<% } %>"></i>
                    <% } %>
                </span>
                <span class="font-small ml-5 text-muted">(25 reviews)</span>
            </div> -->



            <div class="product-detail-rating">
                <span>Ratings: </span>
                <span class="rating-stars">
                    <!-- Static star code -->
                    <i class="fas fa-star text-warning"></i>
                    <i class="fas fa-star text-warning"></i>
                    <i class="fas fa-star text-warning"></i>
                    <i class="fas fa-star text-warning"></i>
                    <i class="fas fa-star text-muted"></i>
                </span>
                <span class="font-small ml-5 text-muted">(25 reviews)</span>
            </div>
            


            <div class="product-price">

                <div style="font-size: 14px; text-decoration: line-through;">
                    <span class="old-price font-md ml-15"><i class="fas fa-indian-rupee-sign"></i><%= product.regularPrice %></span>
                </div>
                <div style="color:darkgreen; ">
                    <ins><span class="text-brand"><i class="fas fa-indian-rupee-sign"></i><%= product.salePrice %></span></ins>
                </div>
                
                
            </div>

            

<!-------------------------------------------------------------------------------->
            <div>
            <li id="stock-status">
                <% if (product.quantity > 1) { %>
                    <span class="in-stock text-success">Availability: <%= product.quantity %> Items in Stock</span>
                <% } else { %>
                    <span class="out-of-stock text-danger">Availability: Out of Stock</span>
                <% } %>
            </li>
            </div>
            <!-------------------------------------------------------------------------------->

            <div class="short-desc">
                <p>Description :<%= product.description %></p>
            </div>

            <span class="thin-line"></span>

            <div class="product_sort_info">
                <ul class="product-meta">
                    <li>Highlights: <%= product.highlights %></li>
                    <li>Warranty: 1 Year</li>
                    <li>Return Policy: 30 Days</li>
                    <li>Cash on Delivery: Available</li>
                </ul>
            </div>

            <!-- Add to Cart -->
             <!-- <button onclick="addToCart('<%= product._id %>')">Add to Cart</button> -->
            
            <!-- <button type="submit" class="button button-add-to-cart"
                 <% if (product.quantity === 0 || product.quantity === 1) { %> 
                                    disabled 
                             style="cursor: not-allowed;" 
                <% } else { %> 
                    onclick="addToCart('<%= product._id %>')" 
                <% } %>>Add to Cart</button> -->



                <button
                    id="add-to-cart-btn"
                    class="button button-add-to-cart"
                    onclick="checkStockAndAddToCart('<%= product._id %>', '<%= product.quantity %>')">
                    Add to Cart
                </button>


        </div>
    </div>




</div>



<div class="related-products-section">
    <% if (relatedProducts && relatedProducts.length > 0) { %>
    <h2 style="font-size: 22px; font-weight: 600; margin-bottom: 20px; color: #333;">Related Products</h2>
    <div class="related-products-container" style="display: flex; flex-wrap: wrap; gap: 20px;">

        <% relatedProducts.forEach((product) => { %>
            <div class="related-product-item" style="width: 200px; text-align: center; border: 1px solid #ddd; padding: 15px; border-radius: 8px;">
                <img src="/uploads/re-image/<%= product.productImage[0] %>" alt="<%= product.productName %>" style="width: 100%; height: 150px; object-fit: cover; border-radius: 5px;">
                <h3 style="font-size: 16px; margin: 10px 0; font-weight: 500; color: #555;"><%= product.productName %></h3>
                <div class="price-section" style="margin-bottom: 10px;">
                    <span style="font-size: 14px; text-decoration: line-through; color: #999;">₹<%= product.regularPrice %></span>
                    <span style="font-size: 16px; font-weight: bold; color: darkgreen;">₹<%= product.salePrice %></span>
                </div>
                <a href="/product-details?id=<%= product._id %>" class="button view-details-button" style="display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px;">View Details</a>
            </div>
        <% }) %>

    </div>
    <% } %>
</div>







<%- include("../../views/partials/user/footer") %>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Thumbnail click event
        $('.thumbnail').on('click', function () {
            const imageSrc = $(this).attr('src');
            $('#mainImage').attr('src', imageSrc);
            $('.thumbnail').removeClass('active');
            $(this).addClass('active');
        });

        // Zoom effect
        $('.image-container').on('mousemove', function (e) {
            const offsetX = e.offsetX;
            const offsetY = e.offsetY;
            const width = $(this).width();
            const height = $(this).height();

            const xPercent = (offsetX / width) * 100;
            const yPercent = (offsetY / height) * 100;

            $('#mainImage').css({
                'transform-origin': `${xPercent}% ${yPercent}%`,
            });
        });

        $('.image-container').on('mouseleave', function () {
            $('#mainImage').css('transform-origin', 'center center');
        });
    });
</script>
 

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
    








async function checkStockAndAddToCart(productId, stockQuantity) {
    if (stockQuantity <= 1) {
        Swal.fire({
            icon: 'error',
            title: 'Out of Stock',
            text: 'The product is out of stock and cannot be added to the cart.',
        });
        return;
    }

    // Proceed to add to cart
    const response = await addToCart(productId);

    if (response.success) {
        // Update stock quantity dynamically on the page
        const stockElement = document.getElementById('stock-status');
        const addToCartButton = document.getElementById('add-to-cart-btn');

        // stockQuantity -= 1; // Decrease stock by 1
        // if (stockQuantity <= 1) {
        //     stockElement.innerHTML = '<span class="out-of-stock text-danger">Availability: Out of Stock</span>';
        //     addToCartButton.disabled = true;
        //     addToCartButton.style.cursor = 'not-allowed';
        // } else {
        //     stockElement.innerHTML = `<span class="in-stock text-success">Availability: ${stockQuantity} Items in Stock</span>`;
        // }

        Swal.fire({
            icon: 'success',
            title: 'Added to Cart',
            text: response.message,
            confirmButtonText: 'Go to Cart',
        }).then(() => {
            window.location.href = '/getCart'; // Redirect to cart page
        });
    } else {
        Swal.fire({
            icon: 'warning',
            title: 'Warning',
            text: response.message,
        });
    }
}




async function addToCart(productId) {
    try {
        const response = await fetch(`/addToCart?id=${productId}`, { method: 'POST' });
        const data = await response.json();

        if (data.success) {
            // Redirect to the cart page using the URL returned from the backend
            window.location.href = data.redirectUrl;
        } else {
            // If there is an error, display the message
            alert(data.message);
        }
    } catch (error) {
        console.error('Error adding to cart:', error);
        alert('Something went wrong!');
    }
}









    </script>