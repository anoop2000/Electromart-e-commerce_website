



<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>


<%- include("../../views/partials/user/header") %>


<style>
    .page-header {
  padding: 30px 0;
  color: white;
  text-align: center;
  background-size: cover;
  background-position: center;
}

.breadcrumb-nav {
  margin: 20px 0;
}

.checkout {
  margin: 20px 0;
}

.checkout-discount {
  margin-bottom: 20px;
}

.square-btn {
  width: 150px;
  height: 40px;
  border-radius: 10px;
  padding: 0;
}

.panel-group {
  margin-top: 20px;
}

.panel-heading button {
  background-color: #041d39;
  color: white;
  border-radius: 5px;
  padding: 8px 16px;
  border: none;
  border: 1px solid #041d39;
}

.panel-heading button:hover {
  background-color: white;
  color: #041d39;
}

.summary {
  background-color: #f7f7f7;
  padding: 20px;
  border: 1px solid #ddd;
  margin-bottom: 50px;
  margin-top: 50px;
}

.summary-title {
  font-size: 1.5rem;
  margin-bottom: 20px;
}

.table-summary {
  width: 100%;
  margin-bottom: 20px;
}

.btn-outline-primary-2 {
  

  background-color: #041d39;
  color: white;
}

.btn-outline-primary-2:hover {
  

  background-color: transparent;
  border: 1px solid #041d39;
  color: #041d39;

}

/*-----------------------Breadcrimb section-------------------------------*/
.breadcrumb {
  font-size: 16px;
  margin-bottom: 20px;
  font-family: 'HelveticaNeue-Light', 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  width:780px;
}

.breadcrumb-item {
  text-decoration: none;
  color: #17a2b8; 
  transition: color 0.3s ease;
}

.breadcrumb-item:hover {
  color: red; 
}

.breadcrumb-divider {
  margin: 0 5px;
  color: #6c757d;
}

.breadcrumb-item.current {
  color: #6c757d;
  font-weight: bold;
}


.button-container {
  display: flex;
  gap: 10px; 
}

.button-container .checkout {
  margin: 0; 
}

#shop{
  color : #fff;

}
#shop:hover{
  color: red;
}

img {
    max-width: 50%;
}

#updateId{
    color : white;
}
#updateId :hover{
    color: red;
}


/*   ----------------*/

/* Address Section */


/* Adjust Parent Row for Layout */
.row {
  display: flex;
  flex-wrap: wrap; /* Allows wrapping if needed on smaller screens */
  justify-content: space-between; /* Spaces out elements horizontally */
}

/* Left Column (Main Content) */
.col-lg-10 {
  flex: 0 1 72%; /* Occupies 72% of the row width */
}

/* Right Column (Address Section) */
.col-lg-2 {
  flex: 0 1 28%; /* Occupies 28% of the row width */
  display: flex;
  flex-direction: column; /* Ensures children stack vertically */
  align-items: flex-end; /* Aligns content to the right */
  margin-top: 180px;

}

.btn-order {
  margin-bottom: 200px; /* Adds a 200px gap below the button */
}


/* modal layout*/

.address-dropdown {
  margin-top: 20px;
}

.list-group-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-body .form-group {
  margin-bottom: 15px;
}

.btn-sm {
  margin-left: 5px;
}

#addAddressLabel{
    width : 200px;
}




</style>


<main class="main">
    <div class="container">
      <div class="page-header text-center text-truncate">
        <h1 class="page-title">Checkout</h1>
      </div>
      <!-- End .page-header -->
  
      <div class="breadcrumb">
        <a href="/" class="breadcrumb-item">Home</a>
        <span class="breadcrumb-divider">> </span>
        <a href="/shop" class="breadcrumb-item">Shop</a>
        <span class="breadcrumb-divider">> </span>
        <a href="/getCart" class="breadcrumb-item">Cart</a>
        <span class="breadcrumb-divider">> </span>
        <span class="breadcrumb-item current">Checkout</span>


      </div>
      <!-- End .breadcrumb-nav -->
  
      <div class="row">
        <div class="col-lg-10">
          <div class="checkout">
            <!-- Coupon Section -->
            <div class="checkout-discount">
              <form action="#" id="couponApplyForm" class="d-flex">
                <input type="text" class="form-control flex-grow-1 mr-2" name="couponCode" required id="appendedInputButton">
                <button class="btn btn-primary square-btn" type="submit">Apply Coupon</button>
              </form>
              <label for="checkout-discount-input" class="text-truncate mt-2">
                Have a coupon?<span>Click the button</span>
              </label>
            </div>
            <hr>



            <!-- Order Summary Section -->
            <aside class="col-lg-8">
                <div class="summary">
                  <h3 class="summary-title">Your Order</h3>
                  <table class="table table-summary">
                    <thead>
                      <tr>
                        <th>Image</th>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% cartData.items.forEach(function(item, index) { %>
                        <tr>
                            <td class="product-image">
                                <a href="/product-details?id=<%= item.productId._id %>">
                                    <img src="/uploads/re-image/<%= item.productId.productImage[0] %>" alt="<%= item.productId.productName %>">
                                </a>
                            </td>
            
                          <td>
                            
                              <%= item.productId.productName %>
                            
                          </td>
                          <td><%= item.quantity %></td>
                          <td id="productPrice<%= index %>" class="price-col">₹<%= item.totalPrice %></td>
                        </tr>
                      <% }); %>
              
                      <tr class="summary-subtotal">
                        <td colspan="2">Subtotal:</td>
                        <td>₹<span id="subtotal"><%= grandTotal %></span></td>
                      </tr>
              
                      <tr>
                        <td colspan="2">Shipping:</td>
                        <td>Free shipping</td>
                      </tr>
              
                      <tr class="summary-total">
                        <td colspan="2">Total:</td>
                        <td>₹<span id="grandTotal"><%= finalAmount %></span></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </aside>
              
            </div>
        </div>


            <!--body end -->
  
            <!-- Address Section -->
             <div class="col-lg-2">

                <div class="address-dropdown">
                    <h4 class="address-title">Select Your Address</h4>
                    <ul class="list-group" style="width: 400px;">
                      <% addressData.forEach((address) => { %>
                        <li class="list-group-item">
                          <div class="d-flex justify-content-between align-items-center">
                            <div class="form-check">
                              <!-- Radio Button for Selecting Address -->
                              <input
                                type="radio"
                                class="form-check-input"
                                id="selectAddress<%= address._id %>"
                                name="selectedAddress"
                                value="<%= address._id %>"
                                required
                              />
                              <label class="form-check-label" for="selectAddress<%= address._id %>">
                                <strong><%= address.addressType %></strong> - <%= address.city %>, <%= address.state %>
                              </label>
                            </div>
                            <div>
                              <!-- Edit Button -->
                              <button
                                class="btn btn-sm btn-outline-primary"
                                data-bs-toggle="modal"
                                data-bs-target="#editAddressModal<%= address._id %>"
                              ><a href="editAddress?id=<%=address._id%>"></a>
                              Edit
                              </button>
                  
                              <!-- Delete Button -->
                              <button
                                class="btn btn-sm btn-outline-danger"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteAddressModal<%= address._id %>"
                              >
                                Delete
                              </button>
                            </div>
                          </div>
                        </li>
                  
                        <!-- Edit Modal -->
                        <div
                          class="modal fade"
                          id="editAddressModal<%= address._id %>"
                          tabindex="-1"
                          aria-labelledby="editModalLabel"
                          aria-hidden="true"
                        >
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form action="/checkout/editAddress?id=<%= address._id %>" method="POST">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="editModalLabel">Edit Address</h5>
                                  <button
                                    type="button"
                                    class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="Close"
                                  ></button>
                                </div>
                                <div class="modal-body">
                                  <!-- Updated Fields -->
                                  <div class="form-group">
                                    <label for="name">Address Type:</label>
                                    <input
                                      type="text"
                                      name="addressType"
                                      class="form-control"
                                      value="<%= address.addressType %>"
                                      required
                                    />
                                  </div>
                                  <div class="form-group">
                                    <label for="name">Name:</label>
                                    <input
                                      type="text"
                                      name="name"
                                      class="form-control"
                                      value="<%= address.name %>"
                                      required
                                    />
                                  </div>

                                  <div class="form-group">
                                    <label for="city">City:</label>
                                        <input
                                        type="text"
                                        name="city"
                                        class="form-control"
                                        value="<%= address.city %>"
                                        required
                                        />
                                  </div>

                                  <div class="form-group">
                                    <label for="street">Landmark:</label>
                                    <input
                                      type="text"
                                      name="landMark"
                                      class="form-control"
                                      value="<%= address.landMark %>"
                                      required
                                    />
                                  </div>
                                  <div class="form-group">
                                    <label for="state">State:</label>
                                    <input
                                      type="text"
                                      name="state"
                                      class="form-control"
                                      value="<%= address.state %>"
                                      required
                                    />
                                  </div>

                                  <div class="form-group">
                                    <label for="pinCode">PinCode:</label>
                                    <input
                                      type="text"
                                      name="pinCode"
                                      class="form-control"
                                      value="<%= address.pincode %>"
                                      required
                                    />
                                  </div>

                                  
                                  <div class="form-group">
                                    <label for="phoneNumber">Phone Number:</label>
                                    <input
                                      type="text"
                                      name="phoneNumber"
                                      class="form-control"
                                      value="<%= address.phone %>"
                                      required
                                    />
                                  </div>

                                  <div class="form-group">
                                    <label for="country">Alternate Phone:</label>
                                    <input
                                      type="text"
                                      name="altPhone"
                                      class="form-control"
                                      value="<%= address.altPhone %>"
                                      required
                                    />
                                  </div>

                                </div>
                                <div class="modal-footer">
                                  <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-bs-dismiss="modal"
                                  >
                                    Cancel
                                  </button>
                                  <button type="submit" class="btn btn-primary" id="updateId">Update</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                  
                        <!-- Delete Modal -->
                        <div
                          class="modal fade"
                          id="deleteAddressModal<%= address._id %>"
                          tabindex="-1"
                          aria-labelledby="deleteModalLabel"
                          aria-hidden="true"
                        >
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form action="/address/delete/<%= address._id %>" method="POST">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="deleteModalLabel">Delete Address</h5>
                                  <button
                                    type="button"
                                    class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="Close"
                                  ></button>
                                </div>
                                <div class="modal-body">
                                  Are you sure you want to delete this address?
                                </div>
                                <div class="modal-footer">
                                  <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-bs-dismiss="modal"
                                  >
                                    Cancel
                                  </button>
                                  <button type="submit" class="btn btn-danger">Delete</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                      <% }); %>
                    </ul>
                  </div>
                  
                
                

                  <!--new address adding section start-->



            <div class="container">
                <!-- Add New Address Button -->
                <button 
                  class="btn btn-primary mb-3" 
                  data-bs-toggle="modal" 
                  data-bs-target="#addAddressModal"
                >
                  Add New Address
                </button>
              
                <!-- Address List -->
                <div id="addressList">
                  <!-- Newly added addresses will appear here -->
                </div>
              </div>
              
              <!-- Add Address Modal -->
              <div 
                class="modal fade" 
                id="addAddressModal" 
                tabindex="-1" 
                aria-labelledby="addAddressLabel" 
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <form id="addAddressForm">
                      <div class="modal-header">
                        <h5 class="modal-title" id="addAddressLabel">Add New Address</h5>
                        <button 
                          type="button" 
                          class="btn-close" 
                          data-bs-dismiss="modal" 
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">
                        <div class="form-group mb-3">
                          <label for="addressType">Address Type</label>
                          <input 
                            type="text" 
                            id="addressType" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="name">Name</label>
                          <input 
                            type="text" 
                            id="name" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="city">City</label>
                          <input 
                            type="text" 
                            id="city" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="state">State</label>
                          <input 
                            type="text" 
                            id="state" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="phone">Phone Number</label>
                          <input 
                            type="text" 
                            id="phone" 
                            class="form-control" 
                            required
                          />
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button 
                          type="button" 
                          class="btn btn-secondary" 
                          data-bs-dismiss="modal"
                        >
                          Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">Add</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              
              <!-- Edit Address Modal -->
              <div 
                class="modal fade" 
                id="editAddressModal" 
                tabindex="-1" 
                aria-labelledby="editAddressLabel" 
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <form id="editAddressForm">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editAddressLabel">Edit Address</h5>
                        <button 
                          type="button" 
                          class="btn-close" 
                          data-bs-dismiss="modal" 
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">
                        <input type="hidden" id="editAddressId" />
                        <div class="form-group mb-3">
                          <label for="editAddressType">Address Type</label>
                          <input 
                            type="text" 
                            id="editAddressType" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="editName">Name</label>
                          <input 
                            type="text" 
                            id="editName" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="editCity">City</label>
                          <input 
                            type="text" 
                            id="editCity" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="editState">State</label>
                          <input 
                            type="text" 
                            id="editState" 
                            class="form-control" 
                            required
                          />
                        </div>
                        <div class="form-group mb-3">
                          <label for="editPhone">Phone Number</label>
                          <input 
                            type="text" 
                            id="editPhone" 
                            class="form-control" 
                            required
                          />
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button 
                          type="button" 
                          class="btn btn-secondary" 
                          data-bs-dismiss="modal"
                        >
                          Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">Update</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              







            <!--new address adding section end-->







  
              
              </div> 
              
              

            <!-- Address Section -->


            

            <!--body-->
              
              
  
            <!-- Payment Section -->
            <div class="panel-heading">
              <h6 class="panel-title">
                <button class="btn btn-primary collapsed" type="button" data-toggle="collapse" data-parent="#accordion">
                  Payment Method:
                </button>
              </h6>
            </div>
            <div class="panel-collapse">
              <div class="panel-body">
                <div class="payment-method">
                  <label>
                    <input type="radio" name="payment" value="cod"> Cash On Delivery
                  </label>
                </div>
               
                <button type="submit" id="orderBtn" class="btn btn-outline-primary-2 btn-order btn-block">
                  <span class="btn-text">Place Order</span>
                  
                </button>
              </div>
            </div>
          </div>
          <!-- End Summary -->
        </aside>
      </div>
    </div>
  </main>
  


  <%- include("../../views/partials/user/footer") %>


  
  <script>
   document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('form').forEach(function (form) {
      form.addEventListener('submit', function (event) {
        console.log('Validating form submission...');
        if (!validateModalForm(this)) {
          console.log('Validation failed. Preventing form submission.');
          event.preventDefault();
        }
      });
    });
  });
  
  function validateModalForm(form) {
    let isValid = true;
    const fieldsToValidate = [
      { id: 'addressType', name: 'Address Type', pattern: /.+/, error: 'Address Type is required.' },
      { id: 'name', name: 'Name', pattern: /^[A-Za-z\s]+$/, error: 'Name should contain alphabets only.' },
      { id: 'city', name: 'City', pattern: /^[A-Za-z\s]+$/, error: 'City should contain alphabets only.' },
      { id: 'landMark', name: 'Landmark', pattern: /^[A-Za-z\s]+$/, error: 'Landmark should contain alphabets only.' },
      { id: 'state', name: 'State', pattern: /^[A-Za-z\s]+$/, error: 'State should contain alphabets only.' },
      { id: 'pinCode', name: 'Pincode', pattern: /^\d{6}$/, error: 'Pincode should be a 6-digit number.' },
      { id: 'phoneNumber', name: 'Phone Number', pattern: /^\d{10}$/, error: 'Phone number should be a 10-digit number.' },
      { id: 'altPhone', name: 'Alternate Phone', pattern: /^\d{10}$/, error: 'Alternate phone number should be a 10-digit number.' },
    ];
  
    form.querySelectorAll('.text-danger').forEach((el) => el.remove()); // Clear previous errors
  
    fieldsToValidate.forEach((field) => {
      const input = form.querySelector(`[name="${field.id}"]`);
      if (!input) {
        console.log(`Field "${field.name}" not found in the form.`);
        return;
      }
  
      const inputValue = input.value.trim();
      console.log(`Validating "${field.name}":`, inputValue);
  
      if (!field.pattern.test(inputValue)) {
        console.log(`Validation error: ${field.error}`);
        displayError(input, field.error);
        isValid = false;
      }
    });
  
    const phone = form.querySelector('[name="phoneNumber"]');
    const altPhone = form.querySelector('[name="altPhone"]');
    if (phone && altPhone && phone.value.trim() === altPhone.value.trim()) {
      const errorMessage = 'Phone number and alternate phone number should be different.';
      console.log(errorMessage);
      displayError(phone, errorMessage);
      displayError(altPhone, errorMessage);
      isValid = false;
    }
  
    return isValid;
  }
  
  function displayError(input, message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'text-danger';
    errorDiv.textContent = message;
    input.parentNode.appendChild(errorDiv);
  }

</script>
  